<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">


<html>

<head>

    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
    <title>YDF2 - How requests are processed</title>
    <link href="api/doxygen.css" rel="stylesheet" type="text/css">

</head>

<body>

    <h1>Yellow Duck Framework </h1>

    <h3 align="center">version 2.0.0 </h3>

    <hr size="1" noshade>
    <table width="100%" border="0" cellspacing="0" cellpadding="0">
    <tr>
        <td align="left" width="40%">
            [ <a href="tutorial_02.html">previous</a> ]
            <br>
            <font size="-1"><i>Writing your first application</i></font>
        </td>
        <td align="center" width="20%" valign="top">
            [ <a href="index.html">contents</a> ]
        </td>
        <td align="right" width="40%">
            [ <a href="tutorial_04.html">next</a> ]
            <br>
            <font size="-1"><i>Using templates</i></font>
        </td>
    </tr>
    </table>
    <hr size="1" noshade>

    <h3>4. How requests are processed</h3>
    
    <hr size="1" noshade>

    <p><b>Description</b></p>

    <p>In this chapter, we will see how requests are processed. When you load a
    request from the browser, a lot of things are performed before the actual
    action is processed and the contents is displayed to the end user.</p>


    <p>&nbsp;<br><b>Graphical overview</b></p>

    <p>The following diagram gives you a graphical overview of how requests are
    processed in the Yellow Duck Framework.</p>

    <p><img src="RequestProcessing.gif" width="667" height="759" border="0"></p>
    
    <p>This whole process of handling a request is automatically done by the
    framework. There is no need to code this yourself. Of course, if you want,
    there are a number of things you can override in this workflow to make the
    framework do what you want it to do.</p>

    <p>&nbsp;<br><b>Step 0 - Where is this processing happening?</b></p>

    <p>When you load a file that includes the Yellow Duck Framework using the
    following code, the file will be able to use the functionality of the 
    framework. Including the framework goes as follows:</p>

    <pre class="fragment">require_once( 'YDFramework2/YDF2_init.php' );</pre>

    <p>To process the actual file using the framework, we need to add another
    include file, but we need to include this at the end of the script. The last
    line of every script processed with the Yellow Duck Framework should look
    as follows:</p>

    <pre class="fragment">require_once( 'YDFramework2/YDF2_process.php' );</pre>

    <p>The process script is the one that does what is displayed in the image
    above. Without including this file, nothing will be executed from the
    script and you will probably end up with an empty page as the result.</p>

    <p>Let's go over each step in the process to see how it works and what
    influence it has on the processing of the request.</p>


    <p>&nbsp;<br><b>Step 1 - Check for a request class</b></p>

    <p>When you load a script, the first thing the framework will do is to check
    for a class which is named after the script file. The class name always has
    the same structure. It's basically the basename of the script file with the
    text "Request" appended to it. Let's take a look at some examples:</p>

    <p><table width="100%" border="1" cellspacing="0" cellpadding="0">
        <tr>
            <td width="50%"><b>Script name</b></td>
            <td width="50%"><b>Class name</b></td>
        </tr>
        <tr>
            <td>index.php</td>
            <td>indexRequest</td>
        </tr>
        <tr>
            <td>processing.php</td>
            <td>processingRequest</td>
        </tr>
        <tr>
            <td>MyOwnScriptForProcessing.php</td>
            <td>MyOwnScriptForProcessingRequest</td>
        </tr>
    </table></p>

    <p>If no class with the given name is declared, the execution will stop with
    a fatal error indicating this. The fatal error will also stop the execution
    of the script.</p>

    <p><b>Note:</b> Class names are case insensitive in the Yellow Duck
    Framework. However, we strongly suggest you to maintain the same case as in 
    the filename.</p>

    <p><b>Note:</b> Also note that some characters are not allowed as a class
    name, and as such are not allowed in the filename. Especially characters
    like "-" (a dash), "$" (a dollar sign), "@" (ad sign) and "&" (an ampersand)
    are not allowed.</p> 


    <p>&nbsp;<br><b>Step 2 - Is the request class derived from YDRequest?</b></p>

    <p>The Yellow Duck Framework always expects that the request class has the
    YDRequest class as one of it's parent classes. This is needed because there
    are a number of standard functions from the YDRequest class that are always
    expected to be there.</p>

    <p>You don't have to inherit from the YDRequest class directly. It's allowed
    to define your own request class based on the YDRequest class, and inherit
    from that class instead. You can do this to provide basic functionality to
    your request classes which is not available in the standard YDRequest class.
    You can also use this to change the way requests are processed so that you
    can tailor the framework to suit your needs.</p>

    <p>If the YDRequest is not one of the parent classes from the request class,
    a fatal error is raised and the execution of the script will be stopped.</p>


    <p>&nbsp;<br><b>Step 3 - Is the request class properly initialized?</b></p>

    <p>Inheriting from the YDRequest class is one thing, but it also needs to be
    initialized properly. In the class constructor, you need to make sure you
    call the function with the same name as the class name of the parent class
    to make sure the parent class is initialized properly. If you inherit from
    the YDRequest directly, you code will look as follows:<p>

    <p><pre class="fragment"><span class="comment">// Inherit from the YDRequest class</span>
class indexRequest extends YDRequest {

    <span class="comment">// This is the class constructor for our class. It is</span>
    <span class="comment">// automatically executed by the framework when this class</span>
    <span class="comment">// is instantiated.</span>
    function indexRequest() {

        <span class="comment">// Initialize the parent class, which is the YDRequest</span>
        <span class="comment">// class in this example.</span>
        $this->YDRequest();
    
    }

}</pre></p>

    <p>If you would leave out the function call to YDRequest in the above class,
    a fatal error will be raised indicating that the YDRequest class was not
    properly initialized. The execution will stop at that moment.</p>

    <p>If the YDRequest class was properly initialized, the framework will now
    create an instance of the request class. When instantiating, no parameters
    are passed to the class constructor of the request class.</p>


    <p>&nbsp;<br><b>Step 4 - Does this request requires authentication?</b></p>

    <p>In every request class, you can enable authentication. If you enable
    authentication for a request class, the framework will execute certain
    functions to check if the authentication before the request is processed.<p>

    <p>You can enable authentication in a request class by using the following
    code:</p>
    
    <p><pre class="fragment">$this->setRequiresAuthentication( true );</pre></p>

    <p>It will then use the function "isAuthenticated" from the request class to
    find out if the user is already authenticated. If not, the function
    "authenticationFailed" is executed which can e.g. redirect to the login.
    page which takes care of the rest. After executing the "authenticationFailed"
    function, the execution of the script is stopped.</p>
    
    <p>If the "isAuthenticated" function returns true, the class function 
    "authenticationSucceeded" is executed, after which the execution of the 
    request continues. This function can for example set a session variable
    indicating that we are logged in or can add an entry to the database.</p>

    <p><b>Note:</b> for an in depth look at how authentication is handled in the
    framework, please go through the chapter <a href="tutorial_06.html"
    ><i>How to handle authentication</i></a>.</p>


    <p>&nbsp;<br><b>Step 5 - Is the specified action allowed?</b></p>

    <p>After the authentication tokens are checked, the framework will check if
    the specified action is allowed by calling the "isActionAllowed" function
    which returns a boolean indicating this. This function can for example limit
    certain actions to specific conditions such as the username.<p>

    <p>If the "isActionAllowed" function returns false, the function called
    "actionNotAllowed" will be executed. By default, this function returns a 
    fatal error indicating that the action is not allowed. You can override this
    function to make this work the way you want. After this function is
    executed, the processing of the request will stop.</p>

    <p>In the "isActionAllowed" function, you can use the class function
    "getActionName" to get the name of the current action in lowercase. The
    action name is the same as what is specified with the do function in the
    URL. If no action is specified, the text "default" will be returned which
    always points to the default action.</p>


    <p>&nbsp;<br><b>Step 6 - Process the actual request.</b></p>

    <p>Now that all the different checks are performed, the process function of
    the request class is executed. This will figure out the right function name
    for the function for the specified action, and it will execute this 
    function.<p>


    <p>&nbsp;<br><b>What if?</b></p>

    <p><i>What if I want a different way to specify the actions?</i><p>

    <p>If you want to specify a different way for the framework to determine the
    actions, you will need to override the "getActionName" function to make it
    determine the correct action name.</p>

    <p><i>What if I want a different way of processing the actions?</i><p>

    <p>You will have to override the "process" function of the request class for
    this. This will not change the way the different checks are happening though
    (which is not advised by any means).<p>

    <hr size="1" noshade>
    <table width="100%" border="0" cellspacing="0" cellpadding="0">
    <tr>
        <td align="left" width="40%">
            [ <a href="tutorial_02.html">previous</a> ]
            <br>
            <font size="-1"><i>Writing your first application</i></font>
        </td>
        <td align="center" width="20%" valign="top">
            [ <a href="index.html">contents</a> ]
        </td>
        <td align="right" width="40%">
            [ <a href="tutorial_04.html">next</a> ]
            <br>
            <font size="-1"><i>Using templates</i></font>
        </td>
    </tr>
    </table>
    <hr size="1" noshade>

    <address><small>
        Yellow Duck Framework 2.0.0 by Pieter Claerhout,
        <a href="mailto:pieter@yellowduck.be">pieter@yellowduck.be</a>
    </small></address>

</body>

</html>
