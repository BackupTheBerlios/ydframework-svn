<html>

<head>
    <title>Yellow Duck Framework 2.0 beta 3 - TutorialApp</title>
    <link rel="stylesheet" type="text/css" href="ydf2.css" />
</head>

<body>

    <div class="header">
        <a href="http://www.redcarpethost.com/index.php?c=9&s30" target="_blank"><img src="../../YDFramework2/images/sponsored_by_rch.gif"
         align="right" border="0" alt="Proudly sponsered by Red Carpet Host" width="170" height="69" /></a>
        <h2>Yellow Duck Framework 2.0</h2>
    </div>

    <div class="page">
<h3> Writing your first application (in progress) </h3>
<br />
<a href="Documentation.html">Documentation table of contents</a><br />
<br />
You can consider this chapter as a small tutorial for the Yellow Duck Framework. In this chapter, we will go over some of the very basic concepts of the framework and apply these in a sample application.<br />
<br />
<br />
<h4> Description of the application </h4>
<br />
The sample application we are going to use is a simple notebook which has three options. The following options are supported by our notebook:<br />
<br />
<ul><li> Showing the list of notes (default)
</li><li> Adding a note
</li><li> Deleting a note</li></ul>
<br />
We will also use form validation to make sure that the data entered in the add note form is valid. This will prevent people from adding notes without a title or body.<br />
<br />
After you finished this chapter, the finished example application will look like this:<br />
<br />
<img  src="tutorial_app_default.gif"  border="0"  />
 <br />
<br />
The screen above is used for listing and deleting notes. This screen will also show you a link to the screen that is used for adding new notes.<br />
<br />
The interface for adding a new note will look as follows:<br />
<br />
<img  src="tutorial_app_add.gif"  border="0"  />
 <br />
<br />
The delete screen doesn't really have a user interface. It will remove the item from the list and reload the list once that is done.<br />
<br />
<span class="notes"><em><strong>Note:</strong> In order no to over complicate this example, we will store the notes as files on the disk instead of using a database.</em></span><br />
<br />
<br />
<h4> Structuring the application </h4>
<br />
Before you start writing the actual code, you need to do a little bit of planning and determine which actions you will create to make your application work. In our ase, we are going to make 3 different actions:<br />
<br />
<ul><li> <strong>default:</strong> This is the default action and will show the list of notes. If no notes are found, it should tell us so.
</li><li> <strong>addnote:</strong> This action will take care of adding a new note. It will render the form you need to fill in, but it will also take care of handling the form correctly and saving the result to disk.
</li><li> <strong>deletenote:</strong> This function will delete a note based on it's unique ID. In this example, it will not ask you for confirmation, but it will simply delete the note.</li></ul>
<br />
Now that we know what actions the application will be able to perform, we now need to think about how we can store the notes on disk. We will create an associative array for each note which will contain the title, body and the unique ID for the entry.<br />
<br />
The unique ID for an entry will be created by calculating the <a href="http://www.php.net/md5">md5</a> checksum of the combination of the title and the body. This will ensure that each note is unique.<br />
<br />
<span class="notes"><em><strong>Note:</strong> the example will not warn about the fact that a duplicate entry was entered. It will just overwrite the existing one. I'll leave it up to you to implement that yourself after finishing this chapter. There is a sample included which rewrites this application using a database and adds editing of the notes.</em></span><br />
<br />
We will use the functions provided by the Yellow Duck Framework to load the notes from disk and save the notes to disk. In the framework, there are different objects and functions that take care of this.<br />
<br />
After going through this example, you will have used and explored the following classes and modules in the Yellow Duck Framework:<br />
<br />
<ul><li> YDRequest (class)
</li><li> YDFSDirectory (class)
</li><li> YDFSFile (class)
</li><li> YDForm (class)
</li><li> YDTemplate (class)
</li><li> YDError and YDFatalError (functions)
</li><li> YDObjectUtil (module)</li></ul>
<br />
For more detailed information of the functions and variables exposed by these classes, consult the API documentation.<br />
<br />
<br />
<h4> Creating the directory and the files </h4>
<br />
To start, create a new folder in your webroot called "firstapp". We will store all the files related to this tutorial in that folder. Make sure that this folder is visible by your webserver.<br />
<br />
In this folder, we will need to create two files for our application. We need 1 file called "index.php", which will contain the actual script that drives the application (the logic). We will also need a file which is called "index.tpl" which contains the template for this application. The template will define how the application will be presented in the browser (the presentation).<br />
<br />
By separating the actual script from the presentation, we will make the application a lot easier to maintain and understand. By using this structured way, it will be a lot easier to track down problems because you know immediately where to look.<br />
<br />
<br />
<h4> Implementing the basis of the index.php file </h4>
<br />
The first thing we will do is to implement the basic stuff of the index.php script. As you could read in the first chapter, the name of the file determines how the class should be named. Open the index.php file in a text editor and enter the following text in the file:<br />
<br />
<div class="code"><code><font color="#000000">
<font color="#0000BB">&lt;?php<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Initialize the Yellow Duck Framework<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">require_once( </font><font color="#0000BB">dirname</font><font color="#007700">( </font><font color="#0000BB">__FILE__ </font><font color="#007700">) . </font><font color="#DD0000">'/../../YDFramework2/YDF2_init.php' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Includes<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">require_once( </font><font color="#DD0000">'YDRequest.php' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;require_once( </font><font color="#DD0000">'YDFileSystem.php' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;require_once( </font><font color="#DD0000">'YDUtil.php' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;require_once( </font><font color="#DD0000">'YDForm.php' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;require_once( </font><font color="#DD0000">'YDTemplate.php'&nbsp;&nbsp;</font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Class definition for the index request<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">class </font><font color="#0000BB">index </font><font color="#007700">extends </font><font color="#0000BB">YDRequest </font><font color="#007700">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Class constructor<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">index</font><font color="#007700">() {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Initialize the parent class<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">YDRequest</font><font color="#007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Initialize the template object<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">template </font><font color="#007700">= new </font><font color="#0000BB">YDTemplate</font><font color="#007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Default action<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">actionDefault</font><font color="#007700">() {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Add Note action<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">actionAddNote</font><font color="#007700">() {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Delete note action<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">actionDeleteNote</font><font color="#007700">() {<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Process the request<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">require_once( </font><font color="#0000BB">dirname</font><font color="#007700">( </font><font color="#0000BB">__FILE__ </font><font color="#007700">) . </font><font color="#DD0000">'/../../YDFramework2/YDF2_process.php' </font><font color="#007700">);<br /><br /></font><font color="#0000BB">?&gt;</font>
</font>
</code></div><br />
There are a number of rules to follow to get the basis of the class implemented. Let's go over each one of them:<br />
<br />
<ol type="1)"><li> <strong>Include the init file:</strong> each script that wants to use the Yellow Duck Framework needs to include the "YDF2_init.php" file which initializes the framework. Make sure the path to this file is correct, otherwise, the script will not work.</li></ol>
<br />
<ol type="2)"><li> <strong>Include the needed classes:</strong> The next step is to include all the different classes from the framework you are going to use. I used the require_once to make sure the script doesn't continue without having included these files. You don't need to specify the complete path to these files as the framework will take care of finding the right files.</li></ol>
<br />
<ol type="3)"><li> <strong>Define the main class:</strong> each script that wants to use the Yellow Duck Framework needs to have a class which is named after the name of the file. In our example, the file is named index.php, which means the framework will search for a class called indexRequest. This class needs to extends the YDRequest class to allow the framework to process the request.</li></ol>
<br />
<ol type="4)"><li> <strong>Define the class constructor:</strong> When the instance of our class is created, it will execute the function which has the same name as the class automatically (this function is called the class constructor). In the class constructor,we simply call the YDRequest function (which is the class constructor from the YDRequest class) to make sure the parent class is initialized as well.</li></ol>
<br />
<ol type="5)"><li> <strong>Define the functions for the actions:</strong> For each action,we need to create a separate function in the class. Each function for an action has the name of the action prepended by action as it's function name. These functions do not require any arguments.</li></ol>
<br />
With this implemented, you can already surf to the index.php page, but nothing will be shown. You can try the following URLs:<br />
<br />
<ul><li> <a href="http://localhost/firstapp/index.php">http://localhost/firstapp/index.php</a>
</li><li> <a href="http://localhost/firstapp/index.php?do=addnote">http://localhost/firstapp/index.php?do=addnote</a>
</li><li> <a href="http://localhost/firstapp/index.php?do=deletenote">http://localhost/firstapp/index.php?do=deletenote</a>
</li><li> <a href="http://localhost/firstapp/index.php?do=oops">http://localhost/firstapp/index.php?do=oops</a></li></ul>
<br />
If you typed in everything correctly, only the last URL should return an error because it's pointing to an undefined action in our class.<br />
<br />
<br />
<h4> Improving the class constructor </h4>
<br />
We will add one thing to the class constructor, which is a reference to the data directory. Before you add the code, make a new folder called "data" in the "firstapp" folder. Also make sure that the webserver process can write into that directory. On unix or linux based systems, you can do this with the following shell command:<br />
<br />
<tt>/home/pieter # chmod 777 data</tt><br />
<br />
Once you did that, add the following code to the class constructor:<br />
<br />
<div class="code"><code><font color="#000000">
<font color="#0000BB">&lt;?php<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Set the path to the data directory<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">dataDir </font><font color="#007700">= new </font><font color="#0000BB">YDFSDirectory</font><font color="#007700">( </font><font color="#0000BB">dirname</font><font color="#007700">( </font><font color="#0000BB">__FILE__ </font><font color="#007700">) . </font><font color="#DD0000">'/data/' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Check if the data directory is writeable<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">if ( ! </font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">dataDir</font><font color="#007700">-&gt;</font><font color="#0000BB">isWriteable</font><font color="#007700">() ) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">YDFatalError</font><font color="#007700">( </font><font color="#DD0000">'Data directory must be writable!' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /></font><font color="#0000BB">?&gt;</font>
</font>
</code></div><br />
The index.php will now look as follows:<br />
<br />
<div class="code"><code><font color="#000000">
<font color="#0000BB">&lt;?php<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Initialize the Yellow Duck Framework<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">require_once( </font><font color="#0000BB">dirname</font><font color="#007700">( </font><font color="#0000BB">__FILE__ </font><font color="#007700">) . </font><font color="#DD0000">'/../../YDFramework2/YDF2_init.php' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Includes<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">require_once( </font><font color="#DD0000">'YDRequest.php' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;require_once( </font><font color="#DD0000">'YDFileSystem.php' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;require_once( </font><font color="#DD0000">'YDtUtil.php' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;require_once( </font><font color="#DD0000">'YDForm.php' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;require_once( </font><font color="#DD0000">'YDTemplate.php' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Class definition for the index request<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">class </font><font color="#0000BB">index </font><font color="#007700">extends </font><font color="#0000BB">YDRequest </font><font color="#007700">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Class constructor<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">index</font><font color="#007700">() {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Initialize the parent class<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">YDRequest</font><font color="#007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Initialize the template object<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">template </font><font color="#007700">= new </font><font color="#0000BB">YDTemplate</font><font color="#007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Set the path to the data directory<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">dataDir </font><font color="#007700">= new </font><font color="#0000BB">YDFSDirectory</font><font color="#007700">( </font><font color="#0000BB">dirname</font><font color="#007700">( </font><font color="#0000BB">__FILE__ </font><font color="#007700">) . </font><font color="#DD0000">'/data/' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Check if the data directory is writeable<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">if ( ! </font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">dataDir</font><font color="#007700">-&gt;</font><font color="#0000BB">isWriteable</font><font color="#007700">() ) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">YDFatalError</font><font color="#007700">( </font><font color="#DD0000">'Data directory must be writable!' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Default action<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">actionDefault</font><font color="#007700">() {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Add Note action<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">actionAddNote</font><font color="#007700">() {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Delete note action<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">actionDeleteNote</font><font color="#007700">() {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Process the request<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">require_once( </font><font color="#0000BB">dirname</font><font color="#007700">( </font><font color="#0000BB">__FILE__ </font><font color="#007700">) . </font><font color="#DD0000">'/../../YDFramework2/YDF2_process.php' </font><font color="#007700">);<br /><br /></font><font color="#0000BB">?&gt;</font>
</font>
</code></div><br />
With this code, we create a new YDFSDirectory class which represents a folder on disk. We define it specifically create it in the class constructor to ensure that all the actions are able to use this object (each action needs this).<br />
<br />
We also check if the directory is writeable by the webserver process to ensure that we will be able to save the notes in that directory. If the directory is not writable, we will raise a fatal error which stops the execution and displays the error message.<br />
<br />
Later on, we will see that we can use this object to get a directory listing, but we will also use it to delete and create new files.<br />
<br />
<br />
<h4> Implementing the default action </h4>
<br />
We will now implement the default action. This is the function that is responsible for showing the list of entries.<br />
<br />
Add the following code to the function actionDefault:<br />
<br />
<div class="code"><code><font color="#000000">
<font color="#0000BB">&lt;?php<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Default action<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">actionDefault</font><font color="#007700">() {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Start with an empty list of entries<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$entries </font><font color="#007700">= array();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Loop over the data directory contents<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">foreach( </font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">dataDir</font><font color="#007700">-&gt;</font><font color="#0000BB">getContents</font><font color="#007700">( </font><font color="#DD0000">'*.dat' </font><font color="#007700">) as </font><font color="#0000BB">$entry </font><font color="#007700">) {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Get the contents<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$entry </font><font color="#007700">= </font><font color="#0000BB">$entry</font><font color="#007700">-&gt;</font><font color="#0000BB">getContents</font><font color="#007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Unserialize<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$entry </font><font color="#007700">= </font><font color="#0000BB">YDObjectUtil</font><font color="#007700">::</font><font color="#0000BB">unserialize</font><font color="#007700">( </font><font color="#0000BB">$entry </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Add it to the list of entries<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">array_push</font><font color="#007700">( </font><font color="#0000BB">$entries</font><font color="#007700">, </font><font color="#0000BB">$entry </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Add the entries to the template<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">template</font><font color="#007700">-&gt;</font><font color="#0000BB">assign</font><font color="#007700">( </font><font color="#DD0000">'entries'</font><font color="#007700">, </font><font color="#0000BB">$entries </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Output the template<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">template</font><font color="#007700">-&gt;</font><font color="#0000BB">display</font><font color="#007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /></font><font color="#0000BB">?&gt;</font>
</font>
</code></div><br />
The index.php file will now look as follows:<br />
<br />
<div class="code"><code><font color="#000000">
<font color="#0000BB">&lt;?php<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Initialize the Yellow Duck Framework<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">require_once( </font><font color="#0000BB">dirname</font><font color="#007700">( </font><font color="#0000BB">__FILE__ </font><font color="#007700">) . </font><font color="#DD0000">'/../../YDFramework2/YDF2_init.php' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Includes<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">require_once( </font><font color="#DD0000">'YDRequest.php' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;require_once( </font><font color="#DD0000">'YDFileSystem.php' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;require_once( </font><font color="#DD0000">'YDUtil.php' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;require_once( </font><font color="#DD0000">'YDForm.php' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;require_once( </font><font color="#DD0000">'YDTemplate.php' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Class definition for the index request<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">class </font><font color="#0000BB">index </font><font color="#007700">extends </font><font color="#0000BB">YDRequest </font><font color="#007700">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Class constructor<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">index</font><font color="#007700">() {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Initialize the parent class<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">YDRequest</font><font color="#007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Initialize the template object<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">template </font><font color="#007700">= new </font><font color="#0000BB">YDTemplate</font><font color="#007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Set the path to the data directory<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">dataDir </font><font color="#007700">= new </font><font color="#0000BB">YDFSDirectory</font><font color="#007700">( </font><font color="#0000BB">dirname</font><font color="#007700">( </font><font color="#0000BB">__FILE__ </font><font color="#007700">) . </font><font color="#DD0000">'/data/' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Check if the data directory is writeable<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">if ( ! </font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">dataDir</font><font color="#007700">-&gt;</font><font color="#0000BB">isWriteable</font><font color="#007700">() ) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">YDFatalError</font><font color="#007700">( </font><font color="#DD0000">'Data directory must be writable!' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Default action<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">actionDefault</font><font color="#007700">() {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Start with an empty list of entries<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$entries </font><font color="#007700">= array();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Loop over the data directory contents<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">foreach( </font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">dataDir</font><font color="#007700">-&gt;</font><font color="#0000BB">getContents</font><font color="#007700">( </font><font color="#DD0000">'*.dat' </font><font color="#007700">) as </font><font color="#0000BB">$entry </font><font color="#007700">) {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Get the contents<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$entry </font><font color="#007700">= </font><font color="#0000BB">$entry</font><font color="#007700">-&gt;</font><font color="#0000BB">getContents</font><font color="#007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Unserialize<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$entry </font><font color="#007700">= </font><font color="#0000BB">YDObjectUtil</font><font color="#007700">::</font><font color="#0000BB">unserialize</font><font color="#007700">( </font><font color="#0000BB">$entry </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Add it to the list of entries<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">array_push</font><font color="#007700">( </font><font color="#0000BB">$entries</font><font color="#007700">, </font><font color="#0000BB">$entry </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Add the entries to the template<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">template</font><font color="#007700">-&gt;</font><font color="#0000BB">assign</font><font color="#007700">( </font><font color="#DD0000">'entries'</font><font color="#007700">, </font><font color="#0000BB">$entries </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Output the template<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">template</font><font color="#007700">-&gt;</font><font color="#0000BB">display</font><font color="#007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Add Note action<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">actionAddNote</font><font color="#007700">() {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Delete note action<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">actionDeleteNote</font><font color="#007700">() {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Process the request<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">require_once( </font><font color="#0000BB">dirname</font><font color="#007700">( </font><font color="#0000BB">__FILE__ </font><font color="#007700">) . </font><font color="#DD0000">'/../../YDFramework2/YDF2_process.php' </font><font color="#007700">);<br /><br /></font><font color="#0000BB">?&gt;</font>
</font>
</code></div><br />
The code of this function is pretty self explanatory. Let's go over each line to see what it does:<br />
<br />
<tt>$entries = array();</tt><br />
<br />
This line creates a new array which will use to store the entries in.<br />
<br />
<tt>foreach ( $this-&gt;dataDir-&gt;getContents( '*.dat' ) as $entry )</tt><br />
<br />
This line line will query the data directory and get a YDFSFile object for each file that ends with the extension "dat". The getContents function always returns YDFSFile or YDFSImage objects.<br />
<br />
<tt>$entry = $entry-&gt;getContents();</tt><br />
<br />
This line line will replace the variable $entry with the contents of our YDFSFile object.<br />
<br />
<tt>$entry = YDObjectUtil::unserialize( $entry );</tt><br />
<br />
Since the entries are serialized, we need to unserialize them to get the original object back. The YDObjectUtil::unserialize function will take care of this.<br />
<br />
<tt>array_push( $entries, $entry );</tt><br />
<br />
We now have the original object back, which we will just add to the list of entries.<br />
<br />
<tt>$this-&gt;template-&gt;assign( 'entries', $entries );</tt><br />
<br />
When a new YDRequest class is instantiated, automatically a new template object is created. You can then use the setVar function from the YDRequest class to assign variables to the template. We add a new template variable called "entries" which holds the list of entries.<br />
<br />
<tt>$this-&gt;outputTemplate();</tt><br />
<br />
The last step is to parse the template and output it to the browser. Since we didn't specify the name of the template, it will look for a file with the same name as the script, but which has the extension "tpl" instead of "php". It will parse the template and send the result to the browser.<br />
<br />
If you run the script now in the browser, you will see an empty screen, and no errors should be shown. You don't see anything yet since the template is still an empty file.<br />
<br />
<br />
<h4> Implementing the template </h4>
<br />
Now that we have the default action implemented, we will change the template so that it shows the list of notes which it should do. Here's is how the template looks like to show the list of entries:<br />
<br />
<div class="code"><code><font color="#000000">
&lt;html&gt;<br /><br />&lt;head&gt;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;title&gt;{$YD_FW_NAMEVERS}&lt;/title&gt;<br /><br />&lt;/head&gt;<br /><br />&lt;body&gt;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;{if $YD_ACTION == 'default'}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;h3&gt;Notes&lt;/h3&gt;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;a href="{$YD_SELF_SCRIPT}?do=AddNote"&gt;Add a new note&lt;/a&gt;&lt;/p&gt;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{if $entries}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{foreach from=$entries item=entry}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;b&gt;{$entry[title]}&lt;/b&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a href="{$YD_SELF_SCRIPT}?do=DeleteNote&amp;id={$entry[id]}"&gt;delete&lt;/a&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{$entry[body]}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{/foreach}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{else}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;No notes were found.&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{/if}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;{/if}<br /><br />&lt;/body&gt;<br /><br />&lt;/html&gt;</font>
</code></div><br />
The first thing we do in the template is to check if we are running the default action. Since we are going to combine the templates for all the different actions,we need to make sure we only show the parts relevant for the current action.<br />
<br />
As you can see, this is a plain PHP script which only contains the code needed to display the list. As you can see, we can reference the variables as normal PHP variables and show their contents.<br />
<br />
We also use some special variables in the script that are automatically added to the template by the framework. We use the following ones:<br />
<br />
<ul><li> <strong>$YD_FW_NAMEVERS:</strong> the name and the version of the framework
</li><li> <strong>$YD_ACTION:</strong> the name of the current action (always in lowercase)
</li><li> <strong>$YD_SELF_SCRIPT:</strong> the url of the script itself without parameters</li></ul>
<br />
If you run the script now, it should tell you that no notes were found, as we didn't create any yet. There should also be a link that you can use to add a new entry. The next step is to create the form to add a new entry.<br />
<br />
<br />
<h4> Implementing the addnote action </h4>
<br />
The next step is to implement the action that will take care of adding new items. Add the following code to the actionAddEntry function to do this:<br />
<br />
<div class="code"><code><font color="#000000">
<font color="#0000BB">&lt;?php<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Add Note action<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">actionAddNote</font><font color="#007700">() {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Create the add form<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form </font><font color="#007700">= new </font><font color="#0000BB">YDForm</font><font color="#007700">( </font><font color="#DD0000">'addEntryForm' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Add the elements<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">addElement</font><font color="#007700">( </font><font color="#DD0000">'text'</font><font color="#007700">, </font><font color="#DD0000">'title'</font><font color="#007700">, </font><font color="#DD0000">'Title:' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">addElement</font><font color="#007700">( </font><font color="#DD0000">'textarea'</font><font color="#007700">, </font><font color="#DD0000">'body'</font><font color="#007700">, </font><font color="#DD0000">'Contents:' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">addElement</font><font color="#007700">( </font><font color="#DD0000">'submit'</font><font color="#007700">, </font><font color="#DD0000">'cmdSubmit'</font><font color="#007700">, </font><font color="#DD0000">'Save' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Apply filters<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">addFilter</font><font color="#007700">( </font><font color="#DD0000">'title'</font><font color="#007700">, </font><font color="#DD0000">'trim' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">addFilter</font><font color="#007700">( </font><font color="#DD0000">'body'</font><font color="#007700">, </font><font color="#DD0000">'trim' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Add a rule<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">addRule</font><font color="#007700">( </font><font color="#DD0000">'title'</font><font color="#007700">, </font><font color="#DD0000">'required'</font><font color="#007700">, </font><font color="#DD0000">'Title is required' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">addRule</font><font color="#007700">( </font><font color="#DD0000">'body'</font><font color="#007700">, </font><font color="#DD0000">'required'</font><font color="#007700">, </font><font color="#DD0000">'Contents is required' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Process the form<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">if ( </font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">validate</font><font color="#007700">() ) {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Save the entries in an array<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$entry </font><font color="#007700">= array(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#DD0000">'id' </font><font color="#007700">=&gt; </font><font color="#0000BB">md5</font><font color="#007700">( </font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">getValue</font><font color="#007700">( </font><font color="#DD0000">'title' </font><font color="#007700">) . </font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">getValue</font><font color="#007700">( </font><font color="#DD0000">'body' </font><font color="#007700">) ),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#DD0000">'title' </font><font color="#007700">=&gt; </font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">getValue</font><font color="#007700">( </font><font color="#DD0000">'title' </font><font color="#007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#DD0000">'body' </font><font color="#007700">=&gt; </font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">getValue</font><font color="#007700">( </font><font color="#DD0000">'body' </font><font color="#007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Save the serialized entry to a file<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">dataDir</font><font color="#007700">-&gt;</font><font color="#0000BB">createFile</font><font color="#007700">( </font><font color="#0000BB">$entry</font><font color="#007700">[</font><font color="#DD0000">'id'</font><font color="#007700">] . </font><font color="#DD0000">'.dat'</font><font color="#007700">, </font><font color="#0000BB">YDObjectUtil</font><font color="#007700">::</font><font color="#0000BB">serialize</font><font color="#007700">( </font><font color="#0000BB">$entry </font><font color="#007700">) );<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Forward to the list view<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">forward</font><font color="#007700">( </font><font color="#DD0000">'default' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Return<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">return;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Add the form to the template<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">template</font><font color="#007700">-&gt;</font><font color="#0000BB">assignForm</font><font color="#007700">( </font><font color="#DD0000">'form'</font><font color="#007700">, </font><font color="#0000BB">$form </font><font color="#007700">);<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Output the template<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">template</font><font color="#007700">-&gt;</font><font color="#0000BB">display</font><font color="#007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /></font><font color="#0000BB">?&gt;</font>
</font>
</code></div><br />
The index.php will now look as follows:<br />
<br />
<div class="code"><code><font color="#000000">
<font color="#0000BB">&lt;?php<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Initialize the Yellow Duck Framework<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">require_once( </font><font color="#0000BB">dirname</font><font color="#007700">( </font><font color="#0000BB">__FILE__ </font><font color="#007700">) . </font><font color="#DD0000">'/../../YDFramework2/YDF2_init.php' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Includes<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">require_once( </font><font color="#DD0000">'YDRequest.php' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;require_once( </font><font color="#DD0000">'YDFileSystem.php' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;require_once( </font><font color="#DD0000">'YDUtil.php' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;require_once( </font><font color="#DD0000">'YDForm.php' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;require_once( </font><font color="#DD0000">'YDTemplate.php' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Class definition for the index request<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">class </font><font color="#0000BB">index </font><font color="#007700">extends </font><font color="#0000BB">YDRequest </font><font color="#007700">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Class constructor<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">index</font><font color="#007700">() {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Initialize the parent class<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">YDRequest</font><font color="#007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Initialize the template object<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">template </font><font color="#007700">= new </font><font color="#0000BB">YDTemplate</font><font color="#007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Set the path to the data directory<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">dataDir </font><font color="#007700">= new </font><font color="#0000BB">YDFSDirectory</font><font color="#007700">( </font><font color="#0000BB">dirname</font><font color="#007700">( </font><font color="#0000BB">__FILE__ </font><font color="#007700">) . </font><font color="#DD0000">'/data/' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Check if the data directory is writeable<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">if ( ! </font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">dataDir</font><font color="#007700">-&gt;</font><font color="#0000BB">isWriteable</font><font color="#007700">() ) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">YDFatalError</font><font color="#007700">( </font><font color="#DD0000">'Data directory must be writable!' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Default action<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">actionDefault</font><font color="#007700">() {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Start with an empty list of entries<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$entries </font><font color="#007700">= array();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Loop over the data directory contents<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">foreach( </font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">dataDir</font><font color="#007700">-&gt;</font><font color="#0000BB">getContents</font><font color="#007700">( </font><font color="#DD0000">'*.dat' </font><font color="#007700">) as </font><font color="#0000BB">$entry </font><font color="#007700">) {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Get the contents<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$entry </font><font color="#007700">= </font><font color="#0000BB">$entry</font><font color="#007700">-&gt;</font><font color="#0000BB">getContents</font><font color="#007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Unserialize<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$entry </font><font color="#007700">= </font><font color="#0000BB">YDObjectUtil</font><font color="#007700">::</font><font color="#0000BB">unserialize</font><font color="#007700">( </font><font color="#0000BB">$entry </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Add it to the list of entries<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">array_push</font><font color="#007700">( </font><font color="#0000BB">$entries</font><font color="#007700">, </font><font color="#0000BB">$entry </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Add the entries to the template<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">template</font><font color="#007700">-&gt;</font><font color="#0000BB">assign</font><font color="#007700">( </font><font color="#DD0000">'entries'</font><font color="#007700">, </font><font color="#0000BB">$entries </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Output the template<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">template</font><font color="#007700">-&gt;</font><font color="#0000BB">display</font><font color="#007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Add Note action<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">actionAddNote</font><font color="#007700">() {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Create the add form<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form </font><font color="#007700">= new </font><font color="#0000BB">YDForm</font><font color="#007700">( </font><font color="#DD0000">'addEntryForm' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Add the elements<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">addElement</font><font color="#007700">( </font><font color="#DD0000">'text'</font><font color="#007700">, </font><font color="#DD0000">'title'</font><font color="#007700">, </font><font color="#DD0000">'Title:' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">addElement</font><font color="#007700">( </font><font color="#DD0000">'textarea'</font><font color="#007700">, </font><font color="#DD0000">'body'</font><font color="#007700">, </font><font color="#DD0000">'Contents:' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">addElement</font><font color="#007700">( </font><font color="#DD0000">'submit'</font><font color="#007700">, </font><font color="#DD0000">'cmdSubmit'</font><font color="#007700">, </font><font color="#DD0000">'Save' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Apply filters<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">addFilter</font><font color="#007700">( </font><font color="#DD0000">'title'</font><font color="#007700">, </font><font color="#DD0000">'trim' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">addFilter</font><font color="#007700">( </font><font color="#DD0000">'body'</font><font color="#007700">, </font><font color="#DD0000">'trim' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Add a rule<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">addRule</font><font color="#007700">( </font><font color="#DD0000">'title'</font><font color="#007700">, </font><font color="#DD0000">'required'</font><font color="#007700">, </font><font color="#DD0000">'Title is required' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">addRule</font><font color="#007700">( </font><font color="#DD0000">'body'</font><font color="#007700">, </font><font color="#DD0000">'required'</font><font color="#007700">, </font><font color="#DD0000">'Contents is required' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Process the form<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">if ( </font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">validate</font><font color="#007700">() ) {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Save the entries in an array<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$entry </font><font color="#007700">= array(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#DD0000">'id' </font><font color="#007700">=&gt; </font><font color="#0000BB">md5</font><font color="#007700">( </font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">getValue</font><font color="#007700">( </font><font color="#DD0000">'title' </font><font color="#007700">) . </font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">getValue</font><font color="#007700">( </font><font color="#DD0000">'body' </font><font color="#007700">) ),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#DD0000">'title' </font><font color="#007700">=&gt; </font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">getValue</font><font color="#007700">( </font><font color="#DD0000">'title' </font><font color="#007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#DD0000">'body' </font><font color="#007700">=&gt; </font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">getValue</font><font color="#007700">( </font><font color="#DD0000">'body' </font><font color="#007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Save the serialized entry to a file<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">dataDir</font><font color="#007700">-&gt;</font><font color="#0000BB">createFile</font><font color="#007700">( </font><font color="#0000BB">$entry</font><font color="#007700">[</font><font color="#DD0000">'id'</font><font color="#007700">] . </font><font color="#DD0000">'.dat'</font><font color="#007700">, </font><font color="#0000BB">YDObjectUtil</font><font color="#007700">::</font><font color="#0000BB">serialize</font><font color="#007700">( </font><font color="#0000BB">$entry </font><font color="#007700">) );<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Forward to the list view<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">forward</font><font color="#007700">( </font><font color="#DD0000">'default' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Return<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">return;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Add the form to the template<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">template</font><font color="#007700">-&gt;</font><font color="#0000BB">assignForm</font><font color="#007700">( </font><font color="#DD0000">'form'</font><font color="#007700">, </font><font color="#0000BB">$form </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Output the template<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">template</font><font color="#007700">-&gt;</font><font color="#0000BB">display</font><font color="#007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Delete note action<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">actionDeleteNote</font><font color="#007700">() {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Process the request<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">require_once( </font><font color="#0000BB">dirname</font><font color="#007700">( </font><font color="#0000BB">__FILE__ </font><font color="#007700">) . </font><font color="#DD0000">'/../../YDFramework2/YDF2_process.php' </font><font color="#007700">);<br /><br /></font><font color="#0000BB">?&gt;</font>
</font>
</code></div><br />
This action does two separate things. It knows how to show the form which is used to add a new note, and it also knows how to save a note to a file on disk which can be retrieved later on. Let's evaluate this action step by step:<br />
<br />
<tt>$form = new YDForm( 'addEntryForm' );</tt><br />
<br />
This will create a new formobject called "addEntryForm". We will assign elements to this object to construct the whole form.<br />
<br />
<tt>$form-&gt;addElement( 'text', 'title', 'Title:' );<br />
$form-&gt;addElement( 'textarea', 'body', 'Contents:' );<br />
$form-&gt;addElement( 'submit', 'cmdSubmit', 'Save' );</tt><br />
<br />
Now we add three elements to the form.We add a text element called "title", a textarea called "body" and a submit button called "cmdSubmit". For each of these elements, we also specify a label.<br />
<br />
<tt>$form-&gt;applyFilter( 'title', 'trim' );<br />
$form-&gt;applyFilter( 'body', 'trim' );</tt><br />
<br />
To the title and body field, we also add a filter called "trim". The trim filter will remove all spaces at the beginning and the end of the form values before validating the form. We do this to make sure that e.g. if the title would be just a space, it wouldn't be considered as being valid.<br />
<br />
<tt>$form-&gt;addRule( 'title', 'required', 'Title is required' );<br />
$form-&gt;addRule( 'body', 'required', 'Contents is required' );</tt><br />
<br />
For the validation, we add two rules. With these two rules,we mark the elements title and body as required elements. We also specify the error message in case the validation fails.<br />
<br />
<tt>$this-&gt;template-&gt;assignForm( 'form', $form );</tt><br />
<br />
This function will assign the form object to the template. Please note that we didn't use the setVar function, but used the addForm function instead. We need to use this function because the form object needs some special treatment before it can be used in the template. Never use the setVar function to assing a form object to the template.<br />
<br />
<tt>$this-&gt;template-&gt;display();</tt><br />
<br />
The last step is to parse and output the template which is done by executing the outputTemplate function.<br />
<br />
<span class="notes"><em><strong>Note:</strong> I specifically didn't explain the part which saves the note to a file, as it's not important yet. You first need to understand how this works before we can add the code for saving the note to disk.</em></span><br />
<br />
Before you can run the form, we need to add the code for the form to the template. Add the following stuff just before the &lt;/body&gt; tag in the template:<br />
<br />
<div class="code"><code><font color="#000000">
{if $YD_ACTION == 'addnote'}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;h3&gt;Add a new note&lt;/h3&gt;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;{if $form[errors]}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p style="color: red"&gt;&lt;b&gt;Errors during processing:&lt;/b&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{foreach from=$form[errors] item=error}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;{$error}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{/foreach}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;{/if}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;form {$form[attribs]}&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{$form[title][label]}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{$form[title][html]}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{$form[body][label]}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{$form[body][html]}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{$form[cmdSubmit][html]}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/form&gt;<br /><br />{/if}</font>
</code></div><br />
The index.tpl file will now look as follows:<br />
<br />
<div class="code"><code><font color="#000000">
&lt;html&gt;<br /><br />&lt;head&gt;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;title&gt;{$YD_FW_NAMEVERS}&lt;/title&gt;<br /><br />&lt;/head&gt;<br /><br />&lt;body&gt;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;{if $YD_ACTION == 'default'}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;h3&gt;Notes&lt;/h3&gt;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;a href="{$YD_SELF_SCRIPT}?do=AddNote"&gt;Add a new note&lt;/a&gt;&lt;/p&gt;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{if $entries}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{foreach from=$entries item=entry}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;b&gt;{$entry[title]}&lt;/b&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a href="{$YD_SELF_SCRIPT}?do=DeleteNote&amp;id={$entry[id]}"&gt;delete&lt;/a&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{$entry[body]}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{/foreach}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{else}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;No notes were found.&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{/if}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;{/if}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;{if $YD_ACTION == 'addnote'}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;h3&gt;Add a new note&lt;/h3&gt;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{if $form[errors]}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p style="color: red"&gt;&lt;b&gt;Errors during processing:&lt;/b&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{foreach from=$form[errors] item=error}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;{$error}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{/foreach}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{/if}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;form {$form[attribs]}&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{$form[title][label]}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{$form[title][html]}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{$form[body][label]}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{$form[body][html]}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{$form[cmdSubmit][html]}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/form&gt;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;{/if}<br /><br />&lt;/body&gt;<br /><br />&lt;/html&gt;</font>
</code></div><br />
<br />
If we a look at that code, we see that it will only be shown if the current action is called addnote (always in lowercase!). The first part will take care of showing the errors if there are any.<br />
<br />
The errors are always found in the $form['error'] array. this array is just a list of all the different error messages. In this example, we use a little but of stylesheets to make them appear in red.<br />
<br />
Then, the code for the form itself is added. We first define the form tag, and use the $form['attributes'] variable to automatically add all the parameters of the form such as the action and method. The framework is smart enough to take care of that automatically.<br />
<br />
Then we will add the different elements. Each element can be referenced as $form[elementname]. In this example,we use the label and html properties of each element. The label property contains the label as specified when you created the form object. The html property contains the HTML version of the element.<br />
<br />
This is the only code we need to add for the form. The framework will take care of remembering what was entered in each field and displays it when needed. It will also take care of the error messages.<br />
<br />
Now that we have the basis of the form, you can surf to the index.php page and see what happens. If you submit the form, you will see that the values are remembered accross submits, and that the right errors are raised if the input was not valid. Let's examine the code that saves the entry to disk. We'll go over it step by step.<br />
<br />
<tt>$entry = array(<br />
<div class="indent">'id' =&gt; md5( $form-&gt;getValue( 'title' ) . $form-&gt;getValue( 'body' ) ),<br />
'title' =&gt; $form-&gt;getValue( 'title' ),<br />
'body' =&gt; $form-&gt;getValue( 'body' )</div>
);</tt><br />
<br />
This code will create a new associative array with the information of the entry. We can use the form's exportValue function to get the value of a specific field of the form.We used the md5 function to create the unique ID for the entry.<br />
<br />
<tt>$this-&gt;dataDir-&gt;createFile(<br />
<div class="indent">$entry['id'] . '.dat', YDObjectUtil::serialize( $entry )</div>
);</tt><br />
<br />
The next line does two things. First, it will serialize the array of the object. This means it's converted into code which can be saved to a file, and which can be read later on again to get the original array back. This function is part of the YDObjectUtil module. After we have the array as a serialized item, we can use the createFile function from the YDFSDirectory object to dump it to a file. The file name will be the id of the entry with the extension "dat".<br />
<br />
<tt>$this-&gt;forward( 'default' );</tt><br />
<br />
Now that the note is saved to disk, we need to show the list of notes again. We have two options here. Either you do a redirect, which will redirect you to the url of the default action, but this requires two HTTP interactions. A lot faster is to forward the execution to a different action. The difference is that forwarding appens in the same request.<br />
<br />
<tt>return;</tt><br />
<br />
It's very important to add the return statement, since otherwise, the form will be displayed again.<br />
<br />
<span class="notes"><em><strong>Note:</strong> one could say that instead of forwarding the request to a different action, you could just call the function for that action. Unfortunately, that doesn't work, since the framework will not know that the current action has been changed.</em></span><br />
<br />
If you run the script now, you will be able to add notes and display them. Also try to add a note without a title or description, and check that it is showing the right errors. Also check the contents of the data directory to see that the entries are correctly saved in there.<br />
<br />
<br />
<h4> Implementing the deletenote action </h4>
<br />
To finish off, we will create the action that can delete a note. This action will take 1 parameter from the URL, which is called ID. This entry will contain the unique ID of the entry. To implement this action, add the following code to the actiondeletenote function:<br />
<br />
<div class="code"><code><font color="#000000">
<font color="#0000BB">&lt;?php<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Delete note action<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">actionDeleteNote</font><font color="#007700">() {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Delete the file related to the entry<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">dataDir</font><font color="#007700">-&gt;</font><font color="#0000BB">deleteFile</font><font color="#007700">( </font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#DD0000">'id'</font><font color="#007700">] . </font><font color="#DD0000">'.dat' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Forward to the list view<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">forward</font><font color="#007700">( </font><font color="#DD0000">'default' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /></font><font color="#0000BB">?&gt;</font>
</font>
</code></div><br />
The complete index.php page will now look as follows:<br />
<br />
<div class="code"><code><font color="#000000">
<font color="#0000BB">&lt;?php<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Initialize the Yellow Duck Framework<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">require_once( </font><font color="#0000BB">dirname</font><font color="#007700">( </font><font color="#0000BB">__FILE__ </font><font color="#007700">) . </font><font color="#DD0000">'/../../YDFramework2/YDF2_init.php' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Includes<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">require_once( </font><font color="#DD0000">'YDRequest.php' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;require_once( </font><font color="#DD0000">'YDFileSystem.php' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;require_once( </font><font color="#DD0000">'YDUtil.php' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;require_once( </font><font color="#DD0000">'YDForm.php' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;require_once( </font><font color="#DD0000">'YDTemplate.php' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Class definition for the index request<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">class </font><font color="#0000BB">index </font><font color="#007700">extends </font><font color="#0000BB">YDRequest </font><font color="#007700">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Class constructor<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">index</font><font color="#007700">() {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Initialize the parent class<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">YDRequest</font><font color="#007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Initialize the template object<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">template </font><font color="#007700">= new </font><font color="#0000BB">YDTemplate</font><font color="#007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Set the path to the data directory<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">dataDir </font><font color="#007700">= new </font><font color="#0000BB">YDFSDirectory</font><font color="#007700">( </font><font color="#0000BB">dirname</font><font color="#007700">( </font><font color="#0000BB">__FILE__ </font><font color="#007700">) . </font><font color="#DD0000">'/data/' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Check if the data directory is writeable<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">if ( ! </font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">dataDir</font><font color="#007700">-&gt;</font><font color="#0000BB">isWriteable</font><font color="#007700">() ) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">YDFatalError</font><font color="#007700">( </font><font color="#DD0000">'Data directory must be writable!' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Default action<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">actionDefault</font><font color="#007700">() {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Start with an empty list of entries<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$entries </font><font color="#007700">= array();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Loop over the data directory contents<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">foreach( </font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">dataDir</font><font color="#007700">-&gt;</font><font color="#0000BB">getContents</font><font color="#007700">( </font><font color="#DD0000">'*.dat' </font><font color="#007700">) as </font><font color="#0000BB">$entry </font><font color="#007700">) {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Get the contents<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$entry </font><font color="#007700">= </font><font color="#0000BB">$entry</font><font color="#007700">-&gt;</font><font color="#0000BB">getContents</font><font color="#007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Unserialize<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$entry </font><font color="#007700">= </font><font color="#0000BB">YDObjectUtil</font><font color="#007700">::</font><font color="#0000BB">unserialize</font><font color="#007700">( </font><font color="#0000BB">$entry </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Add it to the list of entries<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">array_push</font><font color="#007700">( </font><font color="#0000BB">$entries</font><font color="#007700">, </font><font color="#0000BB">$entry </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Add the entries to the template<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">template</font><font color="#007700">-&gt;</font><font color="#0000BB">assign</font><font color="#007700">( </font><font color="#DD0000">'entries'</font><font color="#007700">, </font><font color="#0000BB">$entries </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Output the template<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">template</font><font color="#007700">-&gt;</font><font color="#0000BB">display</font><font color="#007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Add Note action<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">actionAddNote</font><font color="#007700">() {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Create the add form<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form </font><font color="#007700">= new </font><font color="#0000BB">YDForm</font><font color="#007700">( </font><font color="#DD0000">'addEntryForm' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Add the elements<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">addElement</font><font color="#007700">( </font><font color="#DD0000">'text'</font><font color="#007700">, </font><font color="#DD0000">'title'</font><font color="#007700">, </font><font color="#DD0000">'Title:' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">addElement</font><font color="#007700">( </font><font color="#DD0000">'textarea'</font><font color="#007700">, </font><font color="#DD0000">'body'</font><font color="#007700">, </font><font color="#DD0000">'Contents:' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">addElement</font><font color="#007700">( </font><font color="#DD0000">'submit'</font><font color="#007700">, </font><font color="#DD0000">'cmdSubmit'</font><font color="#007700">, </font><font color="#DD0000">'Save' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Apply filters<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">addFilter</font><font color="#007700">( </font><font color="#DD0000">'title'</font><font color="#007700">, </font><font color="#DD0000">'trim' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">addFilter</font><font color="#007700">( </font><font color="#DD0000">'body'</font><font color="#007700">, </font><font color="#DD0000">'trim' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Add a rule<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">addRule</font><font color="#007700">( </font><font color="#DD0000">'title'</font><font color="#007700">, </font><font color="#DD0000">'required'</font><font color="#007700">, </font><font color="#DD0000">'Title is required' </font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">addRule</font><font color="#007700">( </font><font color="#DD0000">'body'</font><font color="#007700">, </font><font color="#DD0000">'required'</font><font color="#007700">, </font><font color="#DD0000">'Contents is required' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Process the form<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">if ( </font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">validate</font><font color="#007700">() ) {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Save the entries in an array<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$entry </font><font color="#007700">= array(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#DD0000">'id' </font><font color="#007700">=&gt; </font><font color="#0000BB">md5</font><font color="#007700">( </font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">getValue</font><font color="#007700">( </font><font color="#DD0000">'title' </font><font color="#007700">) . </font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">getValue</font><font color="#007700">( </font><font color="#DD0000">'body' </font><font color="#007700">) ),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#DD0000">'title' </font><font color="#007700">=&gt; </font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">getValue</font><font color="#007700">( </font><font color="#DD0000">'title' </font><font color="#007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#DD0000">'body' </font><font color="#007700">=&gt; </font><font color="#0000BB">$form</font><font color="#007700">-&gt;</font><font color="#0000BB">getValue</font><font color="#007700">( </font><font color="#DD0000">'body' </font><font color="#007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Save the serialized entry to a file<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">dataDir</font><font color="#007700">-&gt;</font><font color="#0000BB">createFile</font><font color="#007700">( </font><font color="#0000BB">$entry</font><font color="#007700">[</font><font color="#DD0000">'id'</font><font color="#007700">] . </font><font color="#DD0000">'.dat'</font><font color="#007700">, </font><font color="#0000BB">YDObjectUtil</font><font color="#007700">::</font><font color="#0000BB">serialize</font><font color="#007700">( </font><font color="#0000BB">$entry </font><font color="#007700">) );<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Forward to the list view<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">forward</font><font color="#007700">( </font><font color="#DD0000">'default' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Return<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">return;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Add the form to the template<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">template</font><font color="#007700">-&gt;</font><font color="#0000BB">assignForm</font><font color="#007700">( </font><font color="#DD0000">'form'</font><font color="#007700">, </font><font color="#0000BB">$form </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Output the template<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">template</font><font color="#007700">-&gt;</font><font color="#0000BB">display</font><font color="#007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Delete note action<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">actionDeleteNote</font><font color="#007700">() {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Delete the file related to the entry<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">dataDir</font><font color="#007700">-&gt;</font><font color="#0000BB">deleteFile</font><font color="#007700">( </font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#DD0000">'id'</font><font color="#007700">] . </font><font color="#DD0000">'.dat' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Forward to the list view<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$this</font><font color="#007700">-&gt;</font><font color="#0000BB">forward</font><font color="#007700">( </font><font color="#DD0000">'default' </font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// Process the request<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">require_once( </font><font color="#0000BB">dirname</font><font color="#007700">( </font><font color="#0000BB">__FILE__ </font><font color="#007700">) . </font><font color="#DD0000">'/../../YDFramework2/YDF2_process.php' </font><font color="#007700">);<br /><br /></font><font color="#0000BB">?&gt;</font>
</font>
</code></div><br />
Let's go over this action to see how it works:<br />
<br />
<tt>$this-&gt;dataDir-&gt;deleteFile( $_GET['id'] . '.dat' );</tt><br />
<br />
With the deleteFile function from the YDFSDirectory object, we can delete the file for this specific note. We find the id of the note in the $_GET['id'] variable, which was passed with the URL.<br />
<br />
<tt>$this-&gt;forward( 'default' );</tt><br />
<br />
After the deletion of the file, we just forward the request to the default action again to show the list of the notes. After adding this code,you can run the sample again and try to delete a note. If you delete the note, it should disappear from the list and the file should also be removed from the data directory.<br />
<br />
<span class="notes"><em><strong>Note:</strong> there are some functions that could be added to this action. First, it could check if there was an ID given or not. If not, you could forward the request to the default action, or you could show an error message. You could also add some checking to see if the entry exists or not before deleting it. Another option is to add a confirmation screen to prevent that someone accidently deletes a note.</em></span><br />
<br />
<a href="Documentation.html">Documentation table of contents</a></div>




    <div class="copyright">
        (c) Copyright 2003-2004 by <a href="mailto:pieter@yellowduck.be">Pieter Claerhout</a>. All rights reserved.
    </div>

</body>

</html>