/* Copyright (C) 2007 gnombat@users.sourceforge.net */
/* License: http://shjs.sourceforge.net/doc/license.html */

function sh_highlightString(inputString,language,builder){var patternStack={_stack:[],getLength:function(){return this._stack.length;},getTop:function(){if(this._stack.length===0){return undefined;}
return this._stack[this._stack.length-1];},push:function(state){this._stack.push(state);},pop:function(){if(this._stack.length===0){throw"pop on empty stack";}
this._stack.pop();}};var i;var pos=0;var currentStyle=null;var output=function(s,style){if(s.length===0){return;}
if(style===null){var pattern=patternStack.getTop();if(pattern!==undefined&&('style'in pattern)&&!('state'in pattern)){style=pattern.style;}}
if(currentStyle!==style){if(currentStyle!==null){builder.endElement();}
if(style!==null){builder.startElement(style);}}
builder.text(s);pos+=s.length;currentStyle=style;};var endOfLinePattern=/\r\n|\r|\n/g;endOfLinePattern.lastIndex=0;while(pos<inputString.length){var start=pos;var endOfLineMatch=endOfLinePattern.exec(inputString);var end;var startOfNextLine;if(endOfLineMatch===null){end=inputString.length;startOfNextLine=inputString.length;}
else{end=endOfLineMatch.index;startOfNextLine=endOfLinePattern.lastIndex;}
var line=inputString.substring(start,end);for(;;){var pattern=patternStack.getTop();var stateIndex=pattern===undefined?0:pattern.next;var state=language[stateIndex];var bestMatch=null;var bestMatchIndex=-1;for(i=0;i<state.length;i++){var regex=state[i].regex;regex.lastIndex=pos-start;var match=regex.exec(line);if(match!==null&&(bestMatch===null||match.index<bestMatch.index)){bestMatch=match;bestMatchIndex=i;}}
if(bestMatch===null){output(line.substring(pos-start),null);break;}
else{if(bestMatch.index>pos-start){output(line.substring(pos-start,bestMatch.index),null);}
pattern=state[bestMatchIndex];var newStyle=null;if('style'in pattern){newStyle=pattern.style;}
var matchedString=bestMatch[0];output(matchedString,newStyle);if('next'in pattern){patternStack.push(pattern);}
else{if('exit'in pattern){patternStack.pop();}
if('exitall'in pattern){while(patternStack.getLength()>0){patternStack.pop();}}}}}
if(currentStyle!==null){builder.endElement();}
currentStyle=null;if(endOfLineMatch){builder.text(endOfLineMatch[0]);}
pos=startOfNextLine;}}
function sh_getClasses(element){var result=[];var htmlClass=element.className;if(htmlClass&&htmlClass.length>0){var htmlClasses=htmlClass.split(" ");for(var i=0;i<htmlClasses.length;i++){if(htmlClasses[i].length>0){result.push(htmlClasses[i]);}}}
return result;}
function sh_addClass(element,name){var htmlClasses=sh_getClasses(element);for(var i=0;i<htmlClasses.length;i++){if(name.toLowerCase()===htmlClasses[i].toLowerCase()){return;}}
htmlClasses.push(name);element.className=htmlClasses.join(" ");}
function sh_getText(element){if(element.nodeType===3||element.nodeType===4){return element.data;}
else{var result='';for(var i=0;i<element.childNodes.length;i++){result+=sh_getText(element.childNodes.item(i));}
return result;}}
var sh_builder={init:function(element){while(element.hasChildNodes()){element.removeChild(element.firstChild);}
var newTextNode=document.createTextNode("");element.appendChild(newTextNode);this._currentTextNode=newTextNode;this._element=element;},startElement:function(style){var span=document.createElement("span");span.className=style;var newTextNode=document.createTextNode("");span.appendChild(newTextNode);this._currentTextNode.parentNode.appendChild(span);this._currentTextNode=newTextNode;},endElement:function(){var newTextNode=document.createTextNode("");this._currentTextNode.parentNode.parentNode.appendChild(newTextNode);this._currentTextNode=newTextNode;},text:function(s){this._currentTextNode.appendData(s);},close:function(){this._element.normalize();}};function sh_highlightElement(element,language){sh_addClass(element,"sh_sourceCode");if(element.normalize){element.normalize();}
var inputString;if(element.childNodes.length===0){return;}
else if(element.childNodes.length===1){if(element.firstChild.nodeType===3||element.firstChild.nodeType===4){inputString=element.firstChild.data;}
else{inputString=sh_getText(element);}}
else{inputString=sh_getText(element);}
sh_builder.init(element);sh_highlightString(inputString,language,sh_builder);sh_builder.close();}
function sh_highlightDocument(){if(!window.sh_languages){return;}
var nodeList=document.getElementsByTagName("pre");for(var i=0;i<nodeList.length;i++){var element=nodeList.item(i);var htmlClasses=sh_getClasses(element);for(var j=0;j<htmlClasses.length;j++){var htmlClass=htmlClasses[j].toLowerCase();if(htmlClass==="sh_sourcecode"){continue;}
var prefix=htmlClass.substr(0,3);if(prefix==="sh_"){var language=htmlClass.substring(3);if(language in sh_languages){sh_highlightElement(element,sh_languages[language]);}
else{throw"Found <pre> element with class='"+htmlClass+"', but no such language exists";}}}}}