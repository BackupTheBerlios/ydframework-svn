<?xml version='1.0' encoding="ISO-8859-1"?>
<chapter id="installing">

    <title>Installing the Yellow Duck Framework</title>

    <para>This chapter will explain you how the Yellow Duck Framework can be installed. It will give you a checklist style overview of all the things you need to do to install and configure the Yellow Duck Framework.</para>

    <sect1 id="installing_prerequisites">

        <title>Prerequisites</title>

        <para>To use the Yellow Duck Framework, you need to have the following prerequisites:</para>

        <itemizedlist spacing="compact">
            <listitem>PHP version 4.2 or newer (tested with PHP 4.3 and PHP 5)</listitem>
            <listitem>Webserver capable of running PHP scripts, such as Apache or Microsoft IIS</listitem>
        </itemizedlist>

        <para>The Yellow Duck Framework was primarily tested on the Windows platformand also has undergone extensive testing on Linux based systems. Currently, the Yellow Duck Framework is only supported with PHP version 4. PHP 5 works but the Yellow Duck Framework 2.0 will not take advantage of the new features provided with PHP 5).</para>

    </sect1>

    <sect1 id="installing_framework_files">

        <title>Examining the Yellow Duck Framework files</title>

        <para>When you downloaded the latest release of the Yellow Duck Framework, you need to decompress it unzip e.g. winzip (Winzip) or the tar command (unix and linux). After decompressing, you will have the following directory structure:</para>

        <programlisting><![CDATA[+- YDFramework-2.0-beta3
   +- index.php
   +- index.tpl
   +- docs
   +- examples
   +- …
   +- YDFramework2
      +- 3rdparty
      +- temp
      +- YDClasses]]></programlisting>

        <para>The main directory of the framework, called "YDFramework-2.0-beta3" in this example, contains a number of sample files. In this directory, there is also a directory called "YDFramework2", which contains the actual framework files. There are a number of subdirectories in the YDFramework2 directory which each have a specific function:</para>

        <itemizedlist spacing="compact">
            <listitem><emphasis role="bold">3rdparty:</emphasis> This directory contains the third party libraries that are needed for the Yellow Duck Framework to work properly.</listitem>
            <listitem><emphasis role="bold">temp:</emphasis> This directory contains the temporary files created by the framework. In here, the cache files for the thumbnails and web downloads will be saved, as well as the temporary items from the template engine.</listitem>
            <listitem><emphasis role="bold">YDClasses:</emphasis> In here, you will find all the classes that make up the framework.</listitem>
        </itemizedlist>

        <para>This directory structure is not really important for using the Yellow Duck Framework. The only thing you might need to do from time to time is to check the temp folder and empty it if it gets too big. You can safely delete it contents without affecting the actual Framework.</para>

        <warning>You will never have to add or alter files in the YDFramework2 directory. It’s not even a good idea to put your own files in there as they might get overridden when you upgrade our framework to a newer version.</warning>

    </sect1>

    <sect1 id="installing_install_overview">

        <title>Installation overview</title>

        <para>There are a number of steps we need to do to get the framework installed properly. The install instructions here apply to the Apache webserver, but similar techniques are available on other servers. These are the steps needed to install the framework:</para>

        <procedure>
            <step>Finding a place for the YDFramework2 directory</step>
            <step>Assigning rights to the YDFramework2 directory</step>
            <step>Configuring Apache to allow .htaccess files</step>
            <step>Configuring the PHP options</step>
            <step>Denying direct access to the templates</step>
            <step>Using auto preprend and auto append</step>
            <step>Configuring the samples</step>
            <step>Testing the installation</step>
        </procedure>

        <para>The next sections describe these steps in detail.</para>

    </sect1>

    <sect1 id="installing_ydf_directory">

        <title>Finding a place for the YDFramework2 directory</title>

        <para>The YDFramework2 directory can be placed anywhere in the file system. For security reasons, we suggest you to put the YDFramework directory in a directory which is not viewable by the webserver. It’s not a good idea to put the YDFramework2 directory into the htdocs folders from Apache.</para>

        <para>The YDFramework2 directory can also be shared among multiple web applications. You only need one YDFramework2 directory on your system. You can if you want install a separate copy for each web application.</para>

        <warning>Note: If you plan to share the Yellow Duck Framework among multiple web applications, you need to think about how you will handle the temporary data from the Framework. A good idea is to write a sheduled task or a cron job that clears the temporary directory every hour to keep the size of this directory within reasonable sizes.</warning>

    </sect1>

    <sect1 id="installing_user_rights">

        <title>Assigning rights to the YDFramework2 directory</title>
        
        <para>Since the framework needs to be able to write temporary data into it’s temp directory, we need to change the rights for this folder. On Windows, you normally don’t need to change this. On a unix or linux based system, you can issue the following command in a shell to do this:</para>

        <programlisting><![CDATA[/home/pieter # chmod 777 YDFramework2/temp]]></programlisting>

        <para>If you are uploading the framework using your FTP client, please check the documentation of your FTP client on how to do this.</para>
        
    </sect1>

    <sect1 id="installing_apache_config">

        <title>Configuring Apache to allow .htaccess files</title>

        <note>This is an optional setting and is already done on most systems. You only need to change this if you plan to use .htaccess files to change the PHP settings or if you want to deny access to the template files.</note>

        <para>In the Apache configuration file, you need to change the following for the web directory of your web application:</para>

        <programlisting><![CDATA[<Directory "C:/Program Files/Apache/htdocs">
    AllowOverride All
</Directory>]]></programlisting>

        <para>With configuring the directory like this in Apache, you indicate that .htaccess files can be used to override the settings.</para>

    </sect1>

    <sect1 id="installing_php_config">

        <title>Configuring the PHP options</title>

        <para>Now that we configured Apache to accept .htaccess files, create a new file called ".htaccess" and save it in the root of your web application. The settings done in the .htaccess file apply to the directory in which the file is stored and to all the directories underneath that directory. I’ve added the following configuration values for PHP to the .htaccess file on my system:</para>

        <programlisting><![CDATA[# Disable magic quotes
php_value magic_quotes_gpc 0
php_value magic_quotes_runtime 0
php_value magic_quotes_sybase 0

# Disabled registering of globals and arg*
php_value register_globals 0
php_value register_argc_argv 0

# Disallow some security holes
php_value allow_call_time_pass_reference 0
php_value allow_url_fopen 0
php_flag short_open_tag Off
php_flag enable_dl Off

# Gzip compress the output
php_flag output_buffering Off
php_flag zlib.output_compression On]]></programlisting>

        <para>With these options turned on, you will have Gzip compressed output from the PHP scripts which helps you save bandwith. Registering of global variables and friends are also turned off, and magic quotes are disabled which improves the security of your PHP scripts.</para>

        <note>For the GZip compression of the output, you need to have the zlib extension loaded in PHP.</note>

        <para>In the installation download, there is a sample .htaccess file included which is called "_default.htaccess". Copy it to the root of your web directory and rename it to ".htaccess".</para>

    </sect1>

    <sect1 id="installing_denying_tpl_access">

        <title>Denying direct access to the templates</title>

        <para>Since we do not want people to access the template files directly, we need to tell Apache to deny access to these files. This can be done by adding the following code to the .htaccess file:</para>

        <programlisting><![CDATA[# Denying direct access to the templates
<FilesMatch "(.tpl|config.php)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Disable directory browsing
Options -Indexes]]></programlisting>

        <para>In the example above, I also denied access to the config.php file, as I do not want people to access this file directly. Directory browsing in the folder is also prehibited to improve security.</para>

    </sect1>
        
    <sect1 id="installing_auto_prepend_append">

        <title>Using auto preprend and auto append</title>

        <para>Instead of having to include the "YDF2_init.php" and "YDF2_process.php" files manually in each script, you can use the auto preprend and auto append options provided by the PHP interpreter.</para>

        <para>To enable this feature, add the following lines to the .htaccess file:</para>

        <programlisting><![CDATA[# Auto include the Framework files
php_value auto_prepend_file "C:/YDFramework2/YDF2_init.php"
php_value auto_append_file "C:/YDFramework2/YDF2_process.php"]]></programlisting>
    
        <para>On Windows, you will have to use forward slashes instead of backslashes. Also make sure you use the complete path to the files.</para>
    
    </sect1>
        
    <sect1 id="installing_testing">
    
        <title>Testing the installation</title>
    
        <para>To test the installation, run the sample scripts provided with the downloads.</para>
    
    </sect1>

</chapter>
